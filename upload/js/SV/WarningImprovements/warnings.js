var SV=SV||{};!function(e,t,i,n){SV.WarningViewToggler=function(e){this.__construct(e)},SV.WarningViewToggler.prototype={__construct:function(t){this.$toggler=t,this.$selectView=t.siblings(t.data("selectview")),this.$radioView=t.siblings(t.data("radioview")),this.phrases={toggleSelect:t.data("toggleselecttext"),toggleRadio:t.data("toggleradiotext")},this.storageName="xf_sv_warningview",this.setting=localStorage.getItem(this.storageName),this.init(),t.on("click",e.context(this,"eClick"))},init:function(){this.setting&&this.setting.length||this.setSetting("select"),"select"===this.setting?(this.$selectView.show(),this.$radioView.remove(),this.$toggler.text(this.phrases.toggleRadio)):(this.$selectView.remove(),this.$toggler.text(this.phrases.toggleSelect))},toggle:function(){"select"===this.setting?this.setSetting("radio"):this.setSetting("select"),t.location.reload()},setSetting:function(e){this.setting=e,localStorage.setItem(this.storageName,this.setting)},eClick:function(e){e.preventDefault(),this.toggle()}},SV.WarningSelector=function(e){this.__construct(e)},SV.WarningSelector.prototype={__construct:function(t){this.$selector=t,this.$customWarningTitle=t.siblings(t.data("customwarningtitle")),this.phrases={noresults:t.data("noresultstext"),placeholder:t.data("placeholdertext")},this.init(),t.on("change",e.context(this,"eChange"))},init:function(){this.$selector.chosen({width:"100%",inherit_select_classes:!0,no_result_text:this.phrases.noresults,placeholder_text_single:this.phrases.placeholder})},eChange:function(t){var i=e(t.target),n=parseInt(i.val()),r=!1,a=e('select[name="warning_definition_id"] option[value="'+n+'"].warningDefinition');0===n?r=!0:a.data("custom-title")&&(r=!0),this.$selector.find('option[value="'+n+'"]').trigger("click"),r?(this.$customWarningTitle.show(),0!==n&&this.$customWarningTitle.val(a.text()),setTimeout(e.context(function(){this.$customWarningTitle.focus()},this),100)):this.$customWarningTitle.hide()}},SV.WarningItemTree=function(e){this.__construct(e)},SV.WarningItemTree.prototype={__construct:function(t){this.$tree=t,this.overlay=t.data("overlay"),this.$searchInput=e(t.data("searchinput")),this.urls={load:t.data("loadurl"),sync:t.data("syncurl"),rename:t.data("renameurl"),categoryEdit:t.data("categoryediturl"),categoryDelete:t.data("categorydeleteurl"),warningEdit:t.data("warningediturl"),warningDelete:t.data("warningdeleteurl")},this.phrases={rename:t.data("renametext"),edit:t.data("edittext"),delete:t.data("deletetext")},this.init(),this.initSearch(),t.on("ready.jstree",e.context(this,"eReady")),t.on("move_node.jstree",e.context(this,"eMoveNode")),t.on("rename_node.jstree",e.context(this,"eRenameNode"))},init:function(){XenForo.ajax(this.urls.load,"",e.context(function(i){this.$tree.jstree({plugins:["contextmenu","dnd","search","types","wholerow"],core:{data:i.tree,check_callback:function(e,t,i){return"rename_node"===e?0!==parseInt(t.id.substr(1)):"move_node"===e&&("category"!==t.type||"#"===i.parent||null==i.parent)},multiple:!1},contextmenu:{items:{rename:{label:this.phrases.rename,_disabled:function(t){var i=e.jstree.reference(t.reference).get_node(t.reference);return 0===parseInt(i.id.substr(1))},action:function(t){var i=e.jstree.reference(t.reference),n=i.get_node(t.reference);i.edit(n)}},edit:{label:this.phrases.edit,action:e.context(function(i){var n,r=e.jstree.reference(i.reference).get_node(i.reference),a=r.id.substr(1);"category"===r.type?n=this.urls.categoryEdit.replace("{id}",a):"definition"===r.type&&(n=this.urls.warningEdit.replace("{id}",a)),t.location=XenForo.canonicalizeUrl(n)},this)},delete:{label:this.phrases.delete,_disabled:function(t){var i=e.jstree.reference(t.reference).get_node(t.reference);return 0===parseInt(i.id.substr(1))},action:e.context(function(t){var i,n=e.jstree.reference(t.reference).get_node(t.reference),r=n.id.substr(1);"category"===n.type?i=this.urls.categoryDelete.replace("{id}",r):"definition"===n.type&&(i=this.urls.warningDelete.replace("{id}",r)),new XenForo.OverlayLoader(e({href:i}),!1,{speed:XenForo.speed.fast}).load()},this)}}},dnd:{copy:!1,is_draggable:!0,touch:"selected",large_drop_target:!0,large_drag_target:!0},search:{show_only_matches:!0},state:{key:"xf_sv_warningitemtree"},types:{"#":{max_depth:3,valid_children:["category"]},category:{max_depth:2,valid_children:["category","definition"]},definition:{icon:"jstree-file",max_depth:0,valid_children:[]}}})},this))},initSearch:function(){var t=!1;this.$searchInput.keyup(e.context(function(){t&&clearTimeout(t),t=setTimeout(e.context(function(){var e=this.$searchInput.val();this.$tree.jstree(!0).search(e)},this),250)},this))},sync:function(){var e={tree:this.$tree.jstree(!0).get_json("#",{flat:!0})};XenForo.ajax(this.urls.sync,e,function(){console.log("Tree synchronized")})},handleLast:function(){if(t.location.hash){var e,i=t.location.hash.replace("#_","");0===i.indexOf("warning-")?e=i.replace("warning-","d"):0===i.indexOf("category-")&&(e=i.replace("category-","c")),e&&this.$tree.jstree(!0).select_node(e)}},eReady:function(){this.sync(),this.overlay&&(this.$tree.find(".jstree-anchor").addClass("OverlayTrigger"),this.$tree.xfActivate()),null===localStorage.getItem("xf_sv_warningitemtree")&&this.$tree.jstree(!0).open_all(),this.handleLast()},eMoveNode:function(){this.sync()},eRenameNode:function(e,t){var i={node:t.node};XenForo.ajax(this.urls.rename,i,function(){console.log("Node renamed")})}},XenForo.ForceDisablerInit=null,XenForo.Disabler=function(t){var i=function(i,r){null!==XenForo.ForceDisablerInit&&(r=XenForo.ForceDisablerInit);var a=n.find("input, select, textarea, button, .inputWrapper, .taggingInput"),s=r?0:XenForo.speed.fast,o=function(e){var t=n.find("input:not([type=hidden], [type=file]), textarea, select, button").first();t.focus();var i=t.val();t.val(""),t.val(i)};t.is(":checked:enabled")?(n.removeAttr("disabled").removeClass("disabled").trigger("DisablerDisabled"),a.removeAttr("disabled").removeClass("disabled"),t.hasClass("Hider")?r?n.show():n.xfFadeDown(s,r?null:o):r||o.call()):(t.hasClass("Hider")&&(r?n.hide():n.xfFadeUp(s,null,s,"easeInBack")),n.prop("disabled",!0).addClass("disabled").trigger("DisablerEnabled"),a.prop("disabled",!0).addClass("disabled").each(function(t,i){var n=e(i),r=n.data("disabled");null!==r&&void 0!==r&&n.val(r)}))},n=e("#"+t.attr("id")+"_Disabler"),r=t.closest("form"),a=function(){setTimeout(i,0)};t.is(":radio")?r.find('input:radio[name="'+t.fieldName()+'"]').click(a):t.click(a),r.bind("reset",a),r.bind("XFRecalculate",function(){i(0,!0)}),i(0,!0),n.find("label, input, select, textarea").click(function(e){t.is(":checked")||(t.prop("checked",!0),i())}),this.setStatus=i},XenForo.FormFiller=function(t){var i={},n=null,r=!1;function a(i,n){if(XenForo.hasResponseError(n))return!1;XenForo.ForceDisablerInit=!0,e.each(n.formValues,function(e,i){var n=t.find(e);n.length&&(n.is(":checkbox, :radio")?n.prop("checked",i).triggerHandler("click"):n.is("select, input, textarea")&&n.val(i))}),setTimeout(function(){XenForo.ForceDisablerInit=null;var t=e(i).data("XenForo.Disabler");"object"==typeof t?t.setStatus():i.focus()},0)}function s(s){var o=e(s.target).data("choice")||e(s.target).val();if(""===o)return!0;i[o]?a(this,i[o]):(n=this,r=!0,XenForo.ajax(t.data("form-filler-url"),{choice:o},function(e,t){i[o]=e,a(n,e)}).always(function(){r=!1}))}t.on("submit",function(e){r&&(e.preventDefault(),e.stopImmediatePropagation())}),this.addControl=function(e){e.click(s)}},XenForo.register("a.WarningViewToggler","SV.WarningViewToggler"),XenForo.register("select.WarningSelector","SV.WarningSelector"),XenForo.register(".WarningItemTree","SV.WarningItemTree")}(jQuery,this,document);
